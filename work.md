# reso_db 작업 기준 (work.md)

이 문서는 구현 방식 통일 및 리펙토링 기준을 고정하기 위한 내부 규칙이다.
기능 삭제 없이, 기존 동작을 유지한 상태에서 구조만 정리하는 것을 목표로 한다.

==================================================
1. 전체 구조 원칙
==================================================

- main.js : 공통 초기화 전용
- 페이지별 JS : 데이터 로드 + 가공 + DOM 렌더 전용
- 공용 로직은 반드시 utils/ 하위 모듈로 이동
- 전역(window) 유틸 사용 금지
- ESM(import) 방식으로 통일

==================================================
2. 엔트리 포인트 규칙
==================================================

[main.js 역할]

- 테마 적용
- 공용 헤더/푸터 로드
- 전역 이벤트 바인딩(필요 시)
- 페이지 DOM 직접 조작 금지

main.js 예시 구조:

public/app/main.js
- DOMContentLoaded 진입점 1개
- setupTheme()
- loadSharedHeader()
- loadSharedFooter()

[페이지 스크립트 역할]

- 해당 페이지 데이터만 처리
- main.js 로직에 의존하지 않음
- 페이지마다 main() 함수 1개 유지

페이지 스크립트 규칙:

- document.addEventListener('DOMContentLoaded', main) 패턴 통일
- 페이지 외 DOM 조작 금지

==================================================
3. utils 구조 규칙
==================================================

폴더 구조 기준:

public/app/utils/
- fetch.js        : fetchJson, 캐시, 에러 처리
- path.js         : data / asset 경로 생성
- text.js         : byString, safeNumber, escapeHtml
- dom.js          : setText, setHtml, clearChildren (선택)
- domain/
  - equipment.js
  - character.js

금지 사항:

- utils에서 페이지 DOM 구조를 가정한 로직 작성 금지
- utils에서 특정 페이지 id / querySelector 하드코딩 금지
- utils에서 렌더 순서에 의존하는 로직 금지

==================================================
4. 경로 규칙 (중요)
==================================================

- 런타임 URL 기준으로만 작성
- 코드에서 "public/" 문자열 사용 금지
- 경로 조합은 반드시 utils/path에서만 수행

경로 원칙:

- data/KR/xxx.json
- assets/item/weapon/xxx.png

페이지 코드에서 문자열 조합 금지
→ 항상 path 유틸 사용

==================================================
5. 데이터 처리 계층 규칙 (Schema Adapter)
==================================================

원칙:

- raw JSON → ViewModel 변환은 한 곳에서만 수행
- DOM 렌더 함수는 ViewModel만 입력으로 받음
- 페이지 파일에서 raw 필드 직접 접근 최소화

구조 개념:

raw JSON
→ adapter (utils/domain)
→ ViewModel
→ render 함수

==================================================
6. DOM 조작 방식 통일
==================================================

아래 둘 중 하나만 선택하여 프로젝트 전체에 적용한다.
혼용 금지.

방식 A:
- utils/dom.js의 helper 함수 사용

방식 B:
- textContent / innerHTML 직접 사용

프로젝트 중간에 방식 변경 금지

==================================================
7. 도메인 로직 분리 규칙
==================================================

[equipment 도메인]

- parseIdCN
- mapQualityToRarity (Orange = UR 등)
- 성장 계산
- 옵션 / 스킬 파싱

→ utils/domain/equipment.js 로만 이동

[character 도메인]

- 캐릭터 rarity
- 캠프 / 포지션
- 배경 / 카드 UI 규칙

→ utils/domain/character.js 로만 이동

페이지 파일에 도메인 규칙 직접 작성 금지

==================================================
8. 리펙토링 작업 순서 고정
==================================================

1. 경로(path) 생성 로직 통일
2. fetch / normalize 계층 통합
3. 중복 유틸 제거
4. 도메인 로직 분리
5. 페이지 코드 슬림화

이 순서 변경 금지

==================================================
9. 리펙토링 시 금지 사항
==================================================

- 기존 기능 제거 금지
- 함수 / 변수명 임의 변경 금지
- 동작 확인 없이 구조 변경 금지
- 추측 기반 구현 금지
- 확실하지 않으면 먼저 질문

==================================================
10. 목적 요약
==================================================

- 지금은 되지만 나중에 터지는 구조 방지
- 페이지 추가 시 복붙 최소화
- 스키마 변경 시 수정 지점 최소화
